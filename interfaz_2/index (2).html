<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interacción con FastAPI - Taller integrado</title>
</head>
<body>
    <h1>Interfaz para FastAPI</h1>

    <button onclick="obtenerItems()">Obtener Ítems (GET)</button>
    <pre id="resultado-get"></pre>

    <h2>Añadir Ítem (POST)</h2>
    <input type="number" id="item-id" placeholder="ID" required>
    <input type="text" id="item-nombre" placeholder="Nombre" required>
    <input type="number" id="item-valor" placeholder="Valor" required>
    <input type="text" id="item-descripcion" placeholder="Descripción">
    <button onclick="crearItem()">Agregar Ítem</button>
    <pre id="resultado-post"></pre>

    <h2>Eliminar Ítem (DELETE)</h2>
    <input type="number" id="delete-id" placeholder="ID a eliminar" required>
    <button onclick="eliminarItem()">Eliminar Ítem</button>
    <pre id="resultado-delete"></pre>

    <h2>Últimos dos Ítems</h2>
    <button onclick="obtenerUltimosItems()">Obtener últimos dos ítems</button>
    <pre id="resultado-ultimos"></pre>

    <script>
        const API_URL = "http://127.0.0.1:8000/items/";

        async function obtenerItems() {
            const response = await fetch(API_URL);
            if (response.ok) {
                const data = await response.json();
                console.log("Datos obtenidos:", data);
                document.getElementById('resultado-get').textContent = JSON.stringify(data, null, 2);
            } else {
                console.error("Error al obtener ítems:", response.status);
                document.getElementById('resultado-get').textContent = "Error al obtener ítems";
            }
        }

        async function crearItem() {
            const item = {
                id: parseInt(document.getElementById('item-id').value),
                nombre: document.getElementById('item-nombre').value,
                Valor: parseFloat(document.getElementById('item-valor').value),
                descripcion: document.getElementById('item-descripcion').value || null
            };

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(item)
            });

            if (response.ok) {
                const data = await response.json();
                console.log("Ítem creado:", data);
                document.getElementById('resultado-post').textContent = JSON.stringify(data, null, 2);
                obtenerItems(); // Actualizar lista
            } else {
                console.error("Error al crear ítem:", response.status);
                document.getElementById('resultado-post').textContent = "Error al crear ítem";
            }
        }

        async function eliminarItem() {
            const id = document.getElementById('delete-id').value;
            const response = await fetch(`${API_URL}${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                console.log(`Ítem con ID ${id} eliminado.`);
                document.getElementById('resultado-delete').textContent = `Ítem con ID ${id} eliminado.`;
                obtenerItems(); // Actualizar lista
            } else {
                console.error("Error al eliminar ítem:", response.status);
                document.getElementById('resultado-delete').textContent = "Error al eliminar ítem";
            }
        }

        async function obtenerUltimosItems() {
            const response = await fetch(`${API_URL}ultimos/`);
            if (response.ok) {
                const data = await response.json();
                console.log("Últimos dos ítems:", data);
                document.getElementById('resultado-ultimos').textContent = JSON.stringify(data, null, 2);
            } else {
                console.error("Error al obtener los últimos ítems:", response.status);
                document.getElementById('resultado-ultimos').textContent = "Error al obtener los últimos ítems";
            }
        }
    </script>
</body>
</html>
